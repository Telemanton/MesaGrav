<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - UJA</title>
    <link rel="stylesheet" th:href="@{/css/styles-keyuser.css}">
    <link rel="stylesheet" th:href="@{/css/styles-admin.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="menu-container">
            <div class="logo">
                <img src="https://idp.ujaen.es/autenticacion/module.php/themeujaen3/assets/logo_uja.png" alt="UJA Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="/admin-home">Inicio</a></li>
                    <li><a href="#">Históricos</a></li>
                    <li class="dropdown-container">
                            <a href="#" id="userDropdown">
                                <i class="fas fa-user-circle"></i>
                                <span
                                    th:text="${currentUser.username}">Usuario</span>
                            </a>
                            <ul id="dropdownMenu" class="dropdown-content">
                                <li><a href="#">Mi Perfil</a></li>
                                <li>
                                    <a href="#"
                                        onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">
                                        Cerrar sesión
                                    </a>
                                </li>
                            </ul>
                            <form id="logoutForm" th:action="@{/logout}"
                                method="post" style="display: none;">
                            </form>
                            <!--¿Por qué hacerlo así?
                            Seguridad: El estándar de Spring Security recomienda que el logout sea una petición POST. Si usas un simple enlace (GET), 
                            cualquier sitio malicioso podría cerrar la sesión del usuario sin su permiso simplemente cargando una imagen con la URL de logout.
                            Redirección: Al usar th:action="@{/logout}", Spring procesará la salida y, por defecto, te enviará a /login?logout.-->
                        </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-wrapper">
        <!-- Mensaje éxito -->
        <div th:if="${mensaje}" class="alert alert-success" th:text="${mensaje}"></div>

        <section class="intro">
            <h1><i class="fas fa-crown"></i> Panel de Administración Completa</h1>
            <p>Gestión total de usuarios y maquinaria industrial.</p>
        </section>

        <section class="articles-grid">
            <!-- Tarjeta 1: Gestión Usuarios (igual que KeyUser) -->
            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-users-cog"></i>
                </div>
                <h2>Gestión de Usuarios</h2>
                <p>Crear, editar y gestionar todas las cuentas del sistema.</p>
                <div class="card-footer">
                    <span class="badge online">Disponible</span>
                    <button class="btn-enter" onclick="window.location.href='/create-user'">Crear Usuario</button>
                </div>
            </div>

            <!-- Tarjeta 2: Crear Admin (NUEVA) -->
            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-user-shield"></i>
                </div>
                <h2>Crear Administrador</h2>
                <p>Crear nuevos administradores con permisos completos.</p>
                <div class="card-footer">
                    <span class="badge online">Disponible</span>
                    <button class="btn-enter" onclick="window.location.href='/create-admin'">Crear Admin</button>
                </div>
            </div>

            <!-- Tarjeta 3: Ver Todos Usuarios (NUEVA) -->
            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-table-list"></i>
                </div>
                <h2>Ver Todos Usuarios</h2>
                <p>Tabla completa con editar y eliminar usuarios.</p>
                <div class="card-footer">
                    <span class="badge online">[[${allUsers != null ? #lists.size(allUsers) : 0}]] usuarios</span>
                    <a href="/admin-users" class="btn-enter">
                        <i class="fas fa-list"></i> Ver Tabla
                    </a>
                </div>
            </div>

            <!-- Tarjetas maquinaria existentes -->
            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-layer-group"></i>
                </div>
                <h2>Mesa Gravimétrica</h2>
                <p>Monitor de separación de minerales.</p>
                <div class="card-footer">
                    <span class="badge online">En línea</span>
                    <button class="btn-enter">Entrar</button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Dropdown menu
        document.getElementById('userDropdown').addEventListener('click', function(e) {
            e.preventDefault();
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        });
        window.onclick = function(event) {
            if (!event.target.closest('.dropdown-container')) {
                document.getElementById('dropdownMenu').classList.remove('show');
            }
        }
    </script>
</body>
</html>
