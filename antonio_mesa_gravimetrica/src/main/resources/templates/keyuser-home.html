<!DOCTYPE html>
<html lang="es">
<!DOCTYPE html>
<html lang="es" **xmlns:th="http://www.thymeleaf.org"**>
<head>
    <meta charset="UTF-8">
    <title>Panel Key User - UJA</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/styles-keyuser.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <header>
        <div class="menu-container">
            <div class="logo">
                <img src="https://idp.ujaen.es/autenticacion/module.php/themeujaen3/assets/logo_uja.png" alt="UJA Logo">
            </div>
            <nav>
                <ul>
                    <li><a href="#">Históricos</a></li>
                    <li class="dropdown-container">
                            <a href="#" id="userDropdown">
                                <i class="fas fa-user-circle"></i>
                                <span
                                    th:text="${currentUser.username}">Usuario</span>
                            </a>
                            <ul id="dropdownMenu" class="dropdown-content">
                                <li><a href="#">Mi Perfil</a></li>
                                <li>
                                    <a href="#"
                                        onclick="event.preventDefault(); document.getElementById('logoutForm').submit();">
                                        Cerrar sesión
                                    </a>
                                </li>
                            </ul>
                            <form id="logoutForm" th:action="@{/logout}"
                                method="post" style="display: none;">
                            </form>
                            <!--¿Por qué hacerlo así?
                            Seguridad: El estándar de Spring Security recomienda que el logout sea una petición POST. Si usas un simple enlace (GET), 
                            cualquier sitio malicioso podría cerrar la sesión del usuario sin su permiso simplemente cargando una imagen con la URL de logout.
                            Redirección: Al usar th:action="@{/logout}", Spring procesará la salida y, por defecto, te enviará a /login?logout.-->
                        </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-wrapper">
        <section class="intro">
            <h1>Gestión Avanzada de Maquinaria Industrial</h1>
            <p>Panel Key User: Gestión de equipos y administración de usuarios.</p>
        </section>

        <section class="articles-grid">
            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-layer-group"></i>
                </div>
                <h2>Mesa Gravimétrica</h2>
                <p>Monitor de separación de minerales por densidad y vibración.</p>
                <div class="card-footer">
                    <span class="badge online">En línea</span>
                    <button class="btn-enter" onclick="window.location.href='/mesa-gravimetrica'">Entrar</button>
                </div>
            </div>

            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-cogs"></i>
                </div>
                <h2>Torno CNC</h2>
                <p>Control de revoluciones, avance y estado de la herramienta de corte.</p>
                <div class="card-footer">
                    <span class="badge offline">Apagado</span>
                    <button class="btn-enter">Entrar</button>
                </div>
            </div>

            <div class="article-card">
                <div class="icon-header">
                    <i class="fas fa-users-cog"></i> <!-- Icono especial para Key User -->
                </div>
                <h2>Gestión de Usuarios</h2>
                <p>Crear, editar y gestionar cuentas de usuarios del sistema.</p>
                <div class="card-footer">
                    <span class="badge online">Disponible</span>
                    <button class="btn-enter" onclick="window.location.href='/create-user'">Crear Usuario</button>
                </div>
            </div>
        </section>

        <section class="user-panel">
            <h3><i class="fas fa-id-badge"></i> Sesión Key User</h3>
            <div class="user-details">
                <p><strong>Operador:</strong> <span>Nombre Apellido (Key User)</span></p>
                <p><strong>Email:</strong> <span>keyuser@ujaen.es</span></p>
                <p><strong>Rol:</strong> <span class="role-keyuser">KEY USER</span></p>
            </div>
        </section>
    </div>

    <script>
        document.getElementById('userDropdown').addEventListener('click', function(e) {
            e.preventDefault();
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('show');
        });

        window.onclick = function(event) {
            if (!event.target.closest('.dropdown-container')) {
                const menu = document.getElementById('dropdownMenu');
                if (menu.classList.contains('show')) {
                    menu.classList.remove('show');
                }
            }
        }
    </script>
</body>
</html>
